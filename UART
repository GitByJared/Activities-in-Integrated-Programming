MAGNAYE  ZEUS JARED A. 

BSIT 2F3 

 

UART 

 

 

ESP32 code[Text Wrapping Break][Text Wrapping Break]#include <WiFi.h> 

#include <Firebase_ESP_Client.h> 

#include <time.h> 

 

// Wi-Fi credentials 

const char* ssid = "jared"; 

const char* password = "12345678"; 

 

// Firebase credentials 

#define API_KEY "AIzaSyBlagWot02c8JxVZbQi2LoG-bmEXmRR1qY" 

#define DATABASE_URL "https://tnpfinals-default-rtdb.firebaseio.com" 

 

// ESP32 device ID 

#define DEVICE_ID "esp32-001" 

#define SENSOR_PATH "/racks/status" 

 

FirebaseData fbdo; 

FirebaseAuth auth; 

FirebaseConfig config; 

 

unsigned long lastSend = 0; 

const unsigned long interval = 5000; 

bool isTimeSynced = false; 

 

HardwareSerial ArduinoSerial(2); // RX2 = GPIO16 (for reading from Uno TX) 

String sensorStatus = ""; 

 

void syncTime() { 

â€¯ Serial.println("âŒ› Syncing NTP time..."); 

â€¯ configTime(0, 0, "time.google.com", "pool.ntp.org"); 

 

â€¯ int attempts = 0; 

â€¯ while (time(nullptr) < 100000 && attempts < 30) { 

â€¯ â€¯ delay(500); 

â€¯ â€¯ Serial.print("."); 

â€¯ â€¯ attempts++; 

â€¯ } 

 

â€¯ time_t now = time(nullptr); 

â€¯ if (now >= 100000) { 

â€¯ â€¯ Serial.println("\nâ° NTP time synced: " + String(now)); 

â€¯ â€¯ isTimeSynced = true; 

â€¯ } else { 

â€¯ â€¯ Serial.println("\nâŒ Time sync failed. Check Wi-Fi or NTP access."); 

â€¯ â€¯ isTimeSynced = false; 

â€¯ } 

} 

 

void setup() { 

â€¯ Serial.begin(115200); 

â€¯ Serial.println("ğŸ“Ÿ Booting..."); 

 

â€¯ WiFi.begin(ssid, password); 

â€¯ Serial.print("ğŸ“¡ Connecting to Wi-Fi"); 

â€¯ while (WiFi.status() != WL_CONNECTED) { 

â€¯ â€¯ delay(500); 

â€¯ â€¯ Serial.print("."); 

â€¯ } 

â€¯ Serial.println("\nâœ… Wi-Fi connected"); 

 

â€¯ syncTime(); 

 

â€¯ config.api_key = API_KEY; 

â€¯ config.database_url = DATABASE_URL; 

â€¯ auth.user.email = ""; 

â€¯ auth.user.password = ""; 

 

â€¯ Firebase.begin(&config, &auth); 

â€¯ Firebase.reconnectWiFi(true); 

 

â€¯ if (Firebase.signUp(&config, &auth, "", "")) { 

â€¯ â€¯ Serial.println("âœ… Firebase anonymous sign-up successful"); 

â€¯ } else { 

â€¯ â€¯ Serial.printf("âŒ Firebase sign-up failed: %s\n", config.signer.signupError.message.c_str()); 

â€¯ } 

 

â€¯ ArduinoSerial.begin(9600, SERIAL_8N1, 16, 17); // RX=16 (from Uno TX), TX unused 

 

â€¯ delay(1000); 

} 

 

void loop() { 

â€¯ // Always read incoming serial data from Arduino 

â€¯ while (ArduinoSerial.available()) { 

â€¯ â€¯ sensorStatus = ArduinoSerial.readStringUntil('\n'); 

â€¯ â€¯ sensorStatus.trim(); // Clean input 

â€¯ â€¯ Serial.println("ğŸ“¥ Received from Arduino: " + sensorStatus); 

â€¯ } 

 

â€¯ // Only send to Firebase every 5 seconds 

â€¯ if (millis() - lastSend >= interval) { 

â€¯ â€¯ lastSend = millis(); 

 

â€¯ â€¯ if (!isTimeSynced) { 

â€¯ â€¯ â€¯ syncTime(); 

â€¯ â€¯ } 

 

â€¯ â€¯ if (isTimeSynced) { 

â€¯ â€¯ â€¯ time_t now = time(nullptr); 

â€¯ â€¯ â€¯ String devicePath = "/devices/" + String(DEVICE_ID); 

 

â€¯ â€¯ â€¯ // Update lastSeen (timestamp) 

â€¯ â€¯ â€¯ bool successTimestamp = Firebase.ready() && 

â€¯ â€¯ â€¯ â€¯ Firebase.RTDB.setInt(&fbdo, devicePath + "/lastSeen", now); 

 

â€¯ â€¯ â€¯ // Update status ("ONLINE") 

â€¯ â€¯ â€¯ bool successStatus = Firebase.ready() && 

â€¯ â€¯ â€¯ â€¯ Firebase.RTDB.setString(&fbdo, devicePath + "/status", "ONLINE"); 

 

â€¯ â€¯ â€¯ if (successTimestamp && successStatus) { 

â€¯ â€¯ â€¯ â€¯ Serial.println("âœ… ONLINE - Data updated: " + String(now)); 

â€¯ â€¯ â€¯ } else { 

â€¯ â€¯ â€¯ â€¯ Serial.println("âŒ OFFLINE - Firebase error: " + fbdo.errorReason()); 

â€¯ â€¯ â€¯ } 

 

â€¯ â€¯ â€¯ // Send latest sensor status 

â€¯ â€¯ â€¯ if (sensorStatus.indexOf("OCCUPIED") >= 0) { 

â€¯ â€¯ â€¯ â€¯ Firebase.RTDB.setString(&fbdo, SENSOR_PATH, "OCCUPIED"); 

â€¯ â€¯ â€¯ â€¯ Serial.println("âœ… Sensor status uploaded: OCCUPIED"); 

â€¯ â€¯ â€¯ } else if (sensorStatus.indexOf("AVAILABLE") >= 0) { 

â€¯ â€¯ â€¯ â€¯ Firebase.RTDB.setString(&fbdo, SENSOR_PATH, "AVAILABLE"); 

â€¯ â€¯ â€¯ â€¯ Serial.println("âœ… Sensor status uploaded: AVAILABLE"); 

â€¯ â€¯ â€¯ } else { 

â€¯ â€¯ â€¯ â€¯ Serial.println("âš ï¸ No valid sensor status to upload."); 

â€¯ â€¯ â€¯ } 

â€¯ â€¯ } else { 

â€¯ â€¯ â€¯ Serial.println("âš ï¸ Skipping Firebase write: NTP time not available."); 

â€¯ â€¯ } 

â€¯ } 

} 

 

ARDUINO UNO CODE FOR SENSOR 

 

const int trigPin = 10; 

const int echoPin = 9; 

const int threshold = 50; // cm â€” if object is within 50 cm, slot is occupied 

 

void setup() { 

â€¯ Serial.begin(9600); 

â€¯ pinMode(trigPin, OUTPUT); 

â€¯ pinMode(echoPin, INPUT); 

} 

 

void loop() { 

â€¯ long duration; 

â€¯ int distance; 

 

â€¯ // Send ultrasonic pulse 

â€¯ digitalWrite(trigPin, LOW); 

â€¯ delayMicroseconds(2); 

â€¯ digitalWrite(trigPin, HIGH); 

â€¯ delayMicroseconds(10); 

â€¯ digitalWrite(trigPin, LOW); 

 

â€¯ // Read the echo time 

â€¯ duration = pulseIn(echoPin, HIGH); 

 

â€¯ // Convert to cm 

â€¯ distance = duration * 0.034 / 2; 

 

â€¯ // Send clean status to ESP32 

â€¯ if (distance < threshold) { 

â€¯ â€¯ Serial.println("OCCUPIED"); 

â€¯ } else { 

â€¯ â€¯ Serial.println("AVAILABLE"); 

â€¯ } 

 

â€¯ delay(1000); // wait 1 second before next read 

} 

 

 

HOME.VUE CODE 

 

<template> 

â€¯ <v-app> 

â€¯ â€¯ <v-main> 

â€¯ â€¯ â€¯ <v-container fluid class="home-container"> 

â€¯ â€¯ â€¯ â€¯ <!-- Top Section --> 

â€¯ â€¯ â€¯ â€¯ <v-row dense justify="space-between" align="stretch"> 

â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Batches Completed --> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-col cols="12" md="4" class="d-flex"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card class="dashboard-card flex-grow-1"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-title class="card-title">Batches Completed</v-card-title> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-text class="text-center"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="text-h3 font-weight-bold text-teal">{{ batchesCompleted }}</div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="text-caption muted">Successful batches today</div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card-text> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card> 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-col> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Smoke Sensor --> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-col cols="12" md="4" class="d-flex"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card class="dashboard-card flex-grow-1"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-title class="card-title"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-icon left class="mr-2" color="teal darken-2">mdi-cloud</v-icon> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ Smoke Remaining 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card-title> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-text class="text-center"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-progress-circular 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :model-value="smokeValue" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ size="120" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ width="10" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ color="teal" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ rotate="360" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ > 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ smokeValue }}% 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-progress-circular> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="text-caption mt-3 muted">Status: Sufficient</div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-progress-linear 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ class="mt-4" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ color="teal" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ height="6" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ rounded 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :model-value="smokeValue" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ ></v-progress-linear> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="text-caption mt-4 font-weight-medium"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ Main Sensor Status: Sufficient 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card-text> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card> 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-col> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Batch In Process --> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-col cols="12" md="4" class="d-flex"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card class="dashboard-card flex-grow-1"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-title class="card-title">Batch In Process</v-card-title> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-text class="text-center"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="text-h5 text-teal mb-2">Slots:</div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="mb-4">{{ selectedSlots.map(s => `Slot ${s + 1}`).join(', ') || 'None' }}</div> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-text-field 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ v-model.number="inputMinutes" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ type="number" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ label="Set Timer (minutes)" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ min="1" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ max="180" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ outlined 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ dense 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ class="mb-3" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ ></v-text-field> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="text-caption muted">Time Remaining</div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="text-h5 font-weight-bold text-teal">{{ formattedCountdown }}</div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="d-flex justify-center mt-4"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-btn @click="startTimer" class="mr-4" color="teal" text dark rounded :disabled="timerRunning"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ Start 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-btn> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-btn @click="stopTimer" color="teal" text dark rounded :disabled="!timerRunning"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ Stop 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-btn> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card-text> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card> 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-col> 

â€¯ â€¯ â€¯ â€¯ </v-row> 

 

â€¯ â€¯ â€¯ â€¯ <!-- Time's Up Dialog --> 

â€¯ â€¯ â€¯ â€¯ <v-dialog v-model="timeUpDialog" max-width="400"> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-card> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-title class="text-h6 font-weight-bold">Time's Up!</v-card-title> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-text>Your batch timer has ended. Please take the necessary action.</v-card-text> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-actions> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-spacer></v-spacer> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-btn color="teal" text @click="acknowledgeTimeUp">OK</v-btn> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card-actions> 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-card> 

â€¯ â€¯ â€¯ â€¯ </v-dialog> 

 

â€¯ â€¯ â€¯ â€¯ <!-- Slot Selection Dialog --> 

â€¯ â€¯ â€¯ â€¯ <v-dialog v-model="showSlotDialog" max-width="500"> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-card> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-title class="text-h6 font-weight-bold">Select Available Slots</v-card-title> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-text> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-checkbox 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ v-for="(slot, index) in availableSlots" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :key="index" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :label="`Slot ${index + 1}`" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :value="index" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ v-model="selectedSlots" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :disabled="!slot" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ ></v-checkbox> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <div class="mt-3 text-caption muted">You may select up to 4 slots.</div> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card-text> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-actions> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-spacer></v-spacer> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-btn color="teal" text @click="showSlotDialog = false">Cancel</v-btn> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-btn 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ color="teal" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ text 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :disabled="selectedSlots.length === 0 || selectedSlots.length > 4" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ @click="confirmSlotSelection" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ > 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ Confirm 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-btn> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-card-actions> 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-card> 

â€¯ â€¯ â€¯ â€¯ </v-dialog> 

â€¯ â€¯ â€¯ </v-container> 

â€¯ â€¯ </v-main> 

â€¯ </v-app> 

</template> 

 

<script setup> 

defineOptions({ name: 'Home' }) 

 

import { ref, computed, onMounted } from 'vue' 

import { getDatabase, ref as dbRef, onValue } from 'firebase/database' 

import { getFirestore, collection, addDoc, Timestamp } from 'firebase/firestore' 

 

// Dashboard states 

const smokeValue = ref(90) 

const rackSensors = ref([true, false, true, true, false]) 

const notifications = ref([ 

â€¯ { title: 'Batch 3 completed successfully.', time: '2 minutes ago' }, 

â€¯ { title: 'Rack 2 sensor status: Available.', time: '10 minutes ago' }, 

â€¯ { title: 'Smoke level optimal.', time: '15 minutes ago' }, 

]) 

 

const batchesCompleted = ref(0) 

const inputMinutes = ref(20) 

const secondsLeft = ref(0) 

const timerRunning = ref(false) 

const timeUpDialog = ref(false) 

 

let timerInterval = null 

 

const formattedCountdown = computed(() => { 

â€¯ const h = String(Math.floor(secondsLeft.value / 3600)).padStart(2, '0') 

â€¯ const m = String(Math.floor((secondsLeft.value % 3600) / 60)).padStart(2, '0') 

â€¯ const s = String(secondsLeft.value % 60).padStart(2, '0') 

â€¯ return `${h}:${m}:${s}` 

}) 

 

const showSlotDialog = ref(false) 

const availableSlots = ref([true, true, true, true]) 

const selectedSlots = ref([]) 

 

const confirmSlotSelection = () => { 

â€¯ showSlotDialog.value = false 

} 

 

const db = getFirestore() 

 

async function saveBatchToFirestore() { 

â€¯ if (selectedSlots.value.length === 0) return 

â€¯ try { 

â€¯ â€¯ const batchData = { 

â€¯ â€¯ â€¯ batchId: `batch-${Date.now()}`, 

â€¯ â€¯ â€¯ items: selectedSlots.value.map(s => `Slot ${s + 1}`), 

â€¯ â€¯ â€¯ startTime: Timestamp.fromDate(new Date(Date.now() - inputMinutes.value * 60 * 1000)), 

â€¯ â€¯ â€¯ endTime: Timestamp.fromDate(new Date()), 

â€¯ â€¯ â€¯ duration: `${inputMinutes.value} mins`, 

â€¯ â€¯ â€¯ status: 'Completed' 

â€¯ â€¯ } 

â€¯ â€¯ await addDoc(collection(db, 'batches'), batchData) 

â€¯ â€¯ console.log('Batch saved to Firestore:', batchData) 

â€¯ } catch (error) { 

â€¯ â€¯ console.error('Error saving batch:', error) 

â€¯ } 

} 

 

const acknowledgeTimeUp = async () => { 

â€¯ timeUpDialog.value = false 

â€¯ batchesCompleted.value += 1 

â€¯ await saveBatchToFirestore() 

â€¯ selectedSlots.value = [] 

} 

 

const startTimer = () => { 

â€¯ if (inputMinutes.value <= 0 || selectedSlots.value.length === 0) return 

â€¯ secondsLeft.value = inputMinutes.value * 60 

â€¯ timerRunning.value = true 

â€¯ clearInterval(timerInterval) 

â€¯ timerInterval = setInterval(() => { 

â€¯ â€¯ if (secondsLeft.value > 0) { 

â€¯ â€¯ â€¯ secondsLeft.value-- 

â€¯ â€¯ } else { 

â€¯ â€¯ â€¯ clearInterval(timerInterval) 

â€¯ â€¯ â€¯ timerRunning.value = false 

â€¯ â€¯ â€¯ timeUpDialog.value = true 

â€¯ â€¯ â€¯ secondsLeft.value = 0 

â€¯ â€¯ } 

â€¯ }, 1000) 

} 

 

const stopTimer = () => { 

â€¯ clearInterval(timerInterval) 

â€¯ timerRunning.value = false 

} 

 

onMounted(() => { 

â€¯ const dbRT = getDatabase() 

â€¯ const rackStatusRef = dbRef(dbRT, '/racks/status') 

â€¯ onValue(rackStatusRef, (snapshot) => { 

â€¯ â€¯ const status = snapshot.val() 

â€¯ â€¯ if (status === 'OCCUPIED') { 

â€¯ â€¯ â€¯ showSlotDialog.value = true 

â€¯ â€¯ } 

â€¯ }) 

}) 

</script> 

 

/* your CSS is untouched */ 

<style scoped> 

.home-container { 

â€¯ padding-top: 48px; 

â€¯ padding-bottom: 48px; 

â€¯ background: linear-gradient(135deg, #f0f4f8, #ffffff); 

} 

 

.dashboard-card { 

â€¯ border-radius: 12px; 

â€¯ box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1); 

â€¯ background-color: #ffffff; 

â€¯ padding: 20px; 

â€¯ display: flex; 

â€¯ flex-direction: column; 

â€¯ justify-content: space-between; 

â€¯ transition: transform 0.2s ease, box-shadow 0.2s ease; 

} 

 

.dashboard-card:hover { 

â€¯ box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15); 

â€¯ transform: translateY(-5px); 

} 

 

.card-title { 

â€¯ font-size: 18px; 

â€¯ font-weight: 600; 

â€¯ color: #333; 

â€¯ display: flex; 

â€¯ align-items: center; 

} 

 

.muted { 

â€¯ color: #777; 

} 

 

.rack-sensor-item, 

.notification-item { 

â€¯ padding: 12px; 

â€¯ background-color: #f9fafb; 

â€¯ border-radius: 8px; 

â€¯ margin-bottom: 8px; 

â€¯ transition: background-color 0.2s ease; 

} 

 

.rack-sensor-item:hover, 

.notification-item:hover { 

â€¯ background-color: #e0f7fa; 

} 

 

.sensor-title { 

â€¯ font-size: 16px; 

â€¯ font-weight: 500; 

} 

 

.sensor-status { 

â€¯ font-size: 14px; 

â€¯ display: flex; 

â€¯ align-items: center; 

} 

 

.status-icon { 

â€¯ margin-right: 8px; 

} 

 

.notification-title { 

â€¯ font-size: 15px; 

â€¯ font-weight: 600; 

â€¯ color: #333; 

} 

 

.notification-time { 

â€¯ font-size: 13px; 

â€¯ color: #777; 

â€¯ margin-top: 4px; 

} 

 

.rack-sensor-card, 

.notification-card { 

â€¯ max-height: 450px; 

â€¯ overflow-y: auto; 

} 

</style> 

 

 

DEVICE.VUE 

 

<template> 

â€¯ <v-app> 

â€¯ â€¯ <v-main> 

â€¯ â€¯ â€¯ <v-container fluid class="pa-8" style="background-color: #E1F5FE; min-height: 100vh;"> 

â€¯ â€¯ â€¯ â€¯ <v-card class="mt-4"> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-title class="text-h6 font-weight-bold text-teal">Device Management</v-card-title> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-row> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-col cols="12" sm="6" md="4"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-text-field 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ v-model="search" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ label="Search Devices" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ class="search-input mb-4" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ outlined 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ dense 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ hide-details 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ ></v-text-field> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-col> 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-row> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ <div class="table-scroll"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-data-table 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :headers="headers" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :items="filteredDevices" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :loading="loading" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ class="elevation-1" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ item-value="id" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ dense 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ > 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <template v-slot:[`item.status`]="{ item }"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-chip :color="getStatusColor(item.status)" text-color="white" small class="ma-1"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ item.status }} 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-chip> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </template> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <template v-slot:no-data> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-alert type="info" color="blue lighten-4" text> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ No registered devices found. 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-alert> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </template> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-data-table> 

â€¯ â€¯ â€¯ â€¯ â€¯ </div> 

â€¯ â€¯ â€¯ â€¯ </v-card> 

â€¯ â€¯ â€¯ </v-container> 

â€¯ â€¯ </v-main> 

â€¯ </v-app> 

</template> 

 

<script setup> 

import { ref, computed, onMounted } from 'vue' 

import { rtdb } from '@/firebase' // âœ… Use exported Realtime DB from firebase.js 

import { ref as dbRef, onValue } from 'firebase/database' 

 

const headers = [ 

â€¯ { title: 'Device ID', key: 'id' }, 

â€¯ { title: 'Device Name', key: 'name' }, 

â€¯ { title: 'Status', key: 'status' } 

] 

 

const devices = ref([]) 

const search = ref('') 

const loading = ref(true) 

 

const fetchDevices = () => { 

â€¯ const devicesRef = dbRef(rtdb, '/devices') // âœ… Use Realtime Database correctly 

 

â€¯ onValue(devicesRef, (snapshot) => { 

â€¯ â€¯ const data = snapshot.val() 

â€¯ â€¯ const now = Date.now() 

 

â€¯ â€¯ if (data) { 

â€¯ â€¯ â€¯ devices.value = Object.keys(data).map(id => { 

â€¯ â€¯ â€¯ â€¯ const device = data[id] 

â€¯ â€¯ â€¯ â€¯ const lastSeen = parseInt(device.lastSeen) * 1000 || 0 // âœ… Use lastSeen and convert to ms 

â€¯ â€¯ â€¯ â€¯ const isOnline = now - lastSeen < 60000 // âœ… 60-second window 

 

â€¯ â€¯ â€¯ â€¯ return { 

â€¯ â€¯ â€¯ â€¯ â€¯ id, 

â€¯ â€¯ â€¯ â€¯ â€¯ ...device, 

â€¯ â€¯ â€¯ â€¯ â€¯ status: isOnline ? 'online' : 'offline' 

â€¯ â€¯ â€¯ â€¯ } 

â€¯ â€¯ â€¯ }) 

â€¯ â€¯ } else { 

â€¯ â€¯ â€¯ devices.value = [] 

â€¯ â€¯ } 

â€¯ â€¯ loading.value = false 

â€¯ }, (error) => { 

â€¯ â€¯ console.error('Firebase fetch error:', error) 

â€¯ â€¯ loading.value = false 

â€¯ }) 

} 

 

onMounted(fetchDevices) 

 

const filteredDevices = computed(() => { 

â€¯ if (!search.value) return devices.value 

â€¯ return devices.value.filter(device => 

â€¯ â€¯ Object.values(device).some(value => 

â€¯ â€¯ â€¯ String(value).toLowerCase().includes(search.value.toLowerCase()) 

â€¯ â€¯ ) 

â€¯ ) 

}) 

 

const getStatusColor = (status) => { 

â€¯ switch (status?.toLowerCase()) { 

â€¯ â€¯ case 'online': return 'green' 

â€¯ â€¯ case 'offline': return 'red' 

â€¯ â€¯ case 'maintenance': return 'orange' 

â€¯ â€¯ default: return 'grey' 

â€¯ } 

} 

</script> 

 

<style scoped> 

.text-teal { 

â€¯ color: #009688; 

} 

 

.v-card { 

â€¯ border-radius: 12px; 

} 

 

.v-data-table { 

â€¯ background-color: white; 

} 

 

.v-chip { 

â€¯ border-radius: 16px; 

â€¯ font-weight: 500; 

â€¯ font-size: 13px; 

} 

 

.search-input { 

â€¯ width: 100%; 

â€¯ max-width: 100%; 

â€¯ border-radius: 8px; 

} 

 

.table-scroll { 

â€¯ overflow-x: auto; 

â€¯ width: 100%; 

} 

 

.v-container { 

â€¯ max-width: 100%; 

} 

</style> 

 

 

HISTORY.VUE CODE 

 

<template> 

â€¯ <v-app> 

â€¯ â€¯ <v-main> 

â€¯ â€¯ â€¯ <v-container fluid class="pa-8" style="background-color: #E1F5FE; min-height: 100vh;"> 

â€¯ â€¯ â€¯ â€¯ <!-- Header Card --> 

â€¯ â€¯ â€¯ â€¯ <v-card class="mt-4"> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-card-title class="text-h6 font-weight-bold text-teal d-flex justify-space-between align-center"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ Batch History 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-btn icon @click="loadBatches" :disabled="loading" :title="'Refresh batches'"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-icon>mdi-refresh</v-icon> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-btn> 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-card-title> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Search Input --> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-text-field 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ v-model="search" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ label="Search Batches" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ class="search-input mb-4" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ outlined 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ dense 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ hide-details 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :style="searchStyle" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ clearable 

â€¯ â€¯ â€¯ â€¯ â€¯ ></v-text-field> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Print Button --> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-btn @click="printTable" color="primary" class="mb-4" :loading="loading" :disabled="loading"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ Print 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-btn> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Loading & Error --> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-alert 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ v-if="error" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ type="error" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ dense 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ class="mb-4" 

â€¯ â€¯ â€¯ â€¯ â€¯ > 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ error }} 

â€¯ â€¯ â€¯ â€¯ â€¯ </v-alert> 

â€¯ â€¯ â€¯ â€¯ â€¯ <v-progress-linear 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ v-if="loading" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ indeterminate 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ color="teal" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ class="mb-4" 

â€¯ â€¯ â€¯ â€¯ â€¯ ></v-progress-linear> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Scrollable Table --> 

â€¯ â€¯ â€¯ â€¯ â€¯ <div class="table-wrapper"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-data-table 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :headers="headers" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :items="filteredBatches" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ class="elevation-1" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ item-value="batchId" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ dense 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :loading="loading" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ loading-text="Loading batches..." 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :items-per-page="10" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :key="batches.length" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ > 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Batch ID --> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <template v-slot:[`item.batchId`]="{ item }"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ item.batchId }} 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </template> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Items count --> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <template v-slot:[`item.items`]="{ item }"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ item.items.length }} 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </template> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Start Time --> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <template v-slot:[`item.startTime`]="{ item }"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ formatDate(item.startTime) }} 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </template> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <!-- End Time --> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <template v-slot:[`item.endTime`]="{ item }"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ formatDate(item.endTime) }} 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </template> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Duration --> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <template v-slot:[`item.duration`]="{ item }"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ getDuration(item.startTime, item.endTime) }} 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </template> 

 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <!-- Status with color chip --> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <template v-slot:[`item.status`]="{ item }"> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ <v-chip 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ :color="getStatusColor(item.status)" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ text-color="white" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ size="small" 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ > 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ {{ item.status }} 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-chip> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </template> 

â€¯ â€¯ â€¯ â€¯ â€¯ â€¯ </v-data-table> 

â€¯ â€¯ â€¯ â€¯ â€¯ </div> 

â€¯ â€¯ â€¯ â€¯ </v-card> 

â€¯ â€¯ â€¯ </v-container> 

â€¯ â€¯ </v-main> 

â€¯ </v-app> 

</template> 

 

<script setup> 

import { ref, computed, onMounted } from 'vue' 

import { collection, getDocs } from 'firebase/firestore' 

import { db } from '@/firebase' 

 

const headers = [ 

â€¯ { text: 'Batch ID', value: 'batchId' }, 

â€¯ { text: 'Items', value: 'items' }, 

â€¯ { text: 'Start Time', value: 'startTime' }, 

â€¯ { text: 'End Time', value: 'endTime' }, 

â€¯ { text: 'Duration', value: 'duration' }, 

â€¯ { text: 'Status', value: 'status' } 

] 

 

const batches = ref([]) 

const search = ref('') 

const loading = ref(false) 

const error = ref(null) 

 

const loadBatches = async () => { 

â€¯ loading.value = true 

â€¯ error.value = null 

â€¯ try { 

â€¯ â€¯ const snapshot = await getDocs(collection(db, 'batches')) 

â€¯ â€¯ batches.value = snapshot.docs.map(doc => { 

â€¯ â€¯ â€¯ const data = doc.data() 

â€¯ â€¯ â€¯ return { 

â€¯ â€¯ â€¯ â€¯ batchId: data.batchId || doc.id, 

â€¯ â€¯ â€¯ â€¯ items: data.items || [], 

â€¯ â€¯ â€¯ â€¯ startTime: data.startTime || null, 

â€¯ â€¯ â€¯ â€¯ endTime: data.endTime || null, 

â€¯ â€¯ â€¯ â€¯ status: data.status || 'Unknown' 

â€¯ â€¯ â€¯ } 

â€¯ â€¯ }) 

â€¯ } catch (err) { 

â€¯ â€¯ error.value = 'Failed to load batches: ' + err.message 

â€¯ } finally { 

â€¯ â€¯ loading.value = false 

â€¯ } 

} 

 

onMounted(() => { 

â€¯ loadBatches() 

}) 

 

const filteredBatches = computed(() => { 

â€¯ if (!search.value.trim()) return batches.value 

â€¯ const term = search.value.toLowerCase().trim() 

â€¯ return batches.value.filter(batch =>  

â€¯ â€¯ batch.batchId.toLowerCase().includes(term) || 

â€¯ â€¯ batch.status.toLowerCase().includes(term) 

â€¯ ) 

}) 

 

const getStatusColor = (status) => { 

â€¯ if (status === 'Completed') return 'green' 

â€¯ if (status === 'In Progress') return 'orange' 

â€¯ return 'grey' 

} 

 

// Safe date formatting, supporting Firestore Timestamp and JS Date objects 

const formatDate = (timestamp) => { 

â€¯ if (!timestamp) return 'N/A' 

â€¯ let dateObj 

â€¯ if (typeof timestamp.toDate === 'function') { 

â€¯ â€¯ // Firestore Timestamp 

â€¯ â€¯ dateObj = timestamp.toDate() 

â€¯ } else if (timestamp instanceof Date) { 

â€¯ â€¯ dateObj = timestamp 

â€¯ } else { 

â€¯ â€¯ return 'Invalid Date' 

â€¯ } 

â€¯ return dateObj.toLocaleString() 

} 

 

const getDuration = (start, end) => { 

â€¯ if (!start) return 'N/A' 

â€¯ if (!end) return 'In Progress' 

â€¯ let startDate = (typeof start.toDate === 'function') ? start.toDate() : start 

â€¯ let endDate = (typeof end.toDate === 'function') ? end.toDate() : end 

â€¯ const diffMs = endDate - startDate 

â€¯ const diffMins = Math.floor(diffMs / 60000) 

â€¯ return `${diffMins} mins` 

} 

 

const printTable = () => { 

â€¯ const printContent = document.querySelector('.v-data-table') 

â€¯ if (!printContent) return 

 

â€¯ const styles = ` 

â€¯ â€¯ <style> 

â€¯ â€¯ â€¯ body { font-family: Arial, sans-serif; font-size: 14px; padding: 10px; } 

â€¯ â€¯ â€¯ table { width: 100%; border-collapse: collapse; } 

â€¯ â€¯ â€¯ th, td { padding: 8px; border: 1px solid #ddd; text-align: left; } 

â€¯ â€¯ â€¯ .v-chip { border-radius: 4px; padding: 4px 8px; color: white; } 

â€¯ â€¯ â€¯ .v-chip.green { background-color: #4caf50; } 

â€¯ â€¯ â€¯ .v-chip.orange { background-color: #ff9800; } 

â€¯ â€¯ â€¯ .v-chip.grey { background-color: #9e9e9e; } 

â€¯ â€¯ </style> 

â€¯ ` 

 

â€¯ const newWin = window.open('', '', 'width=900,height=600') 

â€¯ newWin.document.write('<html><head><title>Batch History</title>') 

â€¯ newWin.document.write(styles) 

â€¯ newWin.document.write('</head><body>') 

â€¯ newWin.document.write(printContent.outerHTML) 

â€¯ newWin.document.write('</body></html>') 

â€¯ newWin.document.close() 

â€¯ newWin.focus() 

â€¯ newWin.print() 

â€¯ newWin.close() 

} 

 

const searchStyle = { 

â€¯ maxWidth: '500px', 

â€¯ marginBottom: '16px', 

â€¯ borderRadius: '8px', 

} 

</script> 

 

<style scoped> 

.text-teal { 

â€¯ color: #009688; 

} 

 

.v-btn { 

â€¯ transition: background-color 0.3s ease; 

} 

 

.v-btn:hover { 

â€¯ background-color: rgba(255, 255, 255, 0.1); 

} 

 

.v-card { 

â€¯ border-radius: 12px; 

} 

 

.v-chip { 

â€¯ border-radius: 16px; 

} 

 

.v-container { 

â€¯ max-width: 100%; 

} 

 

/* Search Field Styling */ 

.search-input { 

â€¯ max-width: 500px; 

â€¯ margin-bottom: 16px; 

â€¯ border-radius: 8px; 

} 

 

.search-input .v-text-field__control { 

â€¯ padding-right: 12px; 

} 

 

.search-input .v-text-field__prepend-inner { 

â€¯ padding-left: 12px; 

} 

 

.search-input .v-text-field__control:focus-within { 

â€¯ border-color: #009688; 

} 

 

/* Table Scroll Wrapper */ 

.table-wrapper { 

â€¯ width: 100%; 

â€¯ overflow-x: auto; 

} 

 

.v-data-table { 

â€¯ min-width: 900px; 

â€¯ background-color: white; 

} 

</style> 

 

 

FIREBASE.JS 

 

import { initializeApp } from 'firebase/app'; 

import { 

â€¯ getAuth, 

â€¯ GoogleAuthProvider, 

â€¯ signInWithPopup, 

â€¯ signOut, 

â€¯ onAuthStateChanged, 

â€¯ createUserWithEmailAndPassword, 

â€¯ signInWithEmailAndPassword 

} from 'firebase/auth'; 

import { 

â€¯ getFirestore, 

â€¯ doc, 

â€¯ getDoc, 

â€¯ setDoc, 

â€¯ updateDoc, 

â€¯ arrayUnion, 

â€¯ Timestamp, 

â€¯ collection // <-- added collection import here for usage if needed 

} from 'firebase/firestore'; 

import { 

â€¯ getDatabase, 

â€¯ ref as dbRef, 

â€¯ set as rtdbSet 

} from 'firebase/database'; 

 

// Initialize Firebase app 

const firebaseConfig = { 

â€¯ apiKey: "AIzaSyBlagWot02c8JxVZbQi2LoG-bmEXmRR1qY", 

â€¯ authDomain: "tnpfinals.firebaseapp.com", 

â€¯ databaseURL: "https://tnpfinals-default-rtdb.firebaseio.com", 

â€¯ projectId: "tnpfinals", 

â€¯ storageBucket: "tnpfinals.firebasestorage.app", 

â€¯ messagingSenderId: "403158358763", 

â€¯ appId: "1:403158358763:web:c76cf2391513917f643cae", 

â€¯ measurementId: "G-Z74BZGVVM8" 

}; 

 

const app = initializeApp(firebaseConfig); 

 

// Firebase services setup 

const auth = getAuth(app); 

const provider = new GoogleAuthProvider(); 

const db = getFirestore(app); 

const rtdb = getDatabase(app); // âœ… Required for Vue Realtime Database connection 

 

// Function to detect device type based on user agent 

const getDeviceType = () => { 

â€¯ const userAgent = navigator.userAgent.toLowerCase(); 

â€¯ if (userAgent.includes('mobile')) return 'Phone'; 

â€¯ if (userAgent.includes('tablet')) return 'Tablet'; 

â€¯ if (userAgent.includes('laptop') || userAgent.includes('macintosh') || userAgent.includes('windows')) return 'Laptop/PC'; 

â€¯ return 'Unknown'; 

}; 

 

// Register web or user device (PC, phone, tablet) in Firestore 

const registerDevice = async (user) => { 

â€¯ try { 

â€¯ â€¯ const deviceType = getDeviceType(); 

â€¯ â€¯ const deviceRef = doc(db, 'Devices', user.uid); 

â€¯ â€¯ const docSnap = await getDoc(deviceRef); 

 

â€¯ â€¯ if (docSnap.exists()) { 

â€¯ â€¯ â€¯ await updateDoc(deviceRef, { 

â€¯ â€¯ â€¯ â€¯ deviceTypes: arrayUnion(deviceType), 

â€¯ â€¯ â€¯ â€¯ lastUpdatedAt: Timestamp.now() 

â€¯ â€¯ â€¯ }); 

â€¯ â€¯ } else { 

â€¯ â€¯ â€¯ await setDoc(deviceRef, { 

â€¯ â€¯ â€¯ â€¯ deviceTypes: [deviceType], 

â€¯ â€¯ â€¯ â€¯ registeredAt: Timestamp.now(), 

â€¯ â€¯ â€¯ â€¯ userID: user.uid 

â€¯ â€¯ â€¯ }); 

â€¯ â€¯ } 

 

â€¯ â€¯ console.log('Web/PC/Phone device registered successfully'); 

â€¯ } catch (error) { 

â€¯ â€¯ console.error('Error registering device in Firestore:', error); 

â€¯ } 

}; 

 

// Optional: Function to register ESP32 or IoT device to Realtime Database 

const registerESP32Device = async (deviceId, name = 'ESP32 Sensor Node', location = 'Lab Room', status = 'online') => { 

â€¯ try { 

â€¯ â€¯ const path = `/devices/${deviceId}`; 

 

â€¯ â€¯ await rtdbSet(dbRef(rtdb, `${path}/id`), deviceId); 

â€¯ â€¯ await rtdbSet(dbRef(rtdb, `${path}/name`), name); 

â€¯ â€¯ await rtdbSet(dbRef(rtdb, `${path}/location`), location); 

â€¯ â€¯ await rtdbSet(dbRef(rtdb, `${path}/status`), status); 

â€¯ â€¯ await rtdbSet(dbRef(rtdb, `${path}/registeredOn`), String(Date.now())); 

 

â€¯ â€¯ console.log('ESP32 device registered in Realtime Database'); 

â€¯ } catch (error) { 

â€¯ â€¯ console.error('Error registering ESP32 device:', error); 

â€¯ } 

}; 

 

// Export Firebase instances and functions 

export { 

â€¯ auth, 

â€¯ provider, 

â€¯ signInWithPopup, 

â€¯ signOut, 

â€¯ onAuthStateChanged, 

â€¯ createUserWithEmailAndPassword, 

â€¯ signInWithEmailAndPassword, 

â€¯ registerDevice, 

â€¯ registerESP32Device, 

â€¯ rtdb, // âœ… Exported for use in frontend (Vue app) 

â€¯ db, â€¯ // âœ… Firestore instance export (added) 

â€¯ collection // optionally export collection if you want to import it from here later 

}; 

 

 
